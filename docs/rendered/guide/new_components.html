<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating New Components | MechWolf</title>
    <meta name="description" content="Continuous flow process automation made easy">
    
    
    <link rel="preload" href="/assets/css/0.styles.f2ecc26c.css" as="style"><link rel="preload" href="/assets/js/app.99d75b88.js" as="script"><link rel="preload" href="/assets/js/2.8d8c6c90.js" as="script"><link rel="preload" href="/assets/js/13.c537ffe1.js" as="script"><link rel="prefetch" href="/assets/js/10.03874750.js"><link rel="prefetch" href="/assets/js/11.0fd5ca09.js"><link rel="prefetch" href="/assets/js/12.9a295110.js"><link rel="prefetch" href="/assets/js/14.6e045fe7.js"><link rel="prefetch" href="/assets/js/15.d9766f80.js"><link rel="prefetch" href="/assets/js/3.f3a2b0d2.js"><link rel="prefetch" href="/assets/js/4.7bf71852.js"><link rel="prefetch" href="/assets/js/5.4b90d31b.js"><link rel="prefetch" href="/assets/js/6.57d34fa3.js"><link rel="prefetch" href="/assets/js/7.9615e47f.js"><link rel="prefetch" href="/assets/js/8.2dc8c665.js"><link rel="prefetch" href="/assets/js/9.4016f513.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f2ecc26c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head10x.png" alt="MechWolf" class="logo"> <span class="site-name can-hide">MechWolf</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/Benjamin-Lee/mechwolf" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/Benjamin-Lee/mechwolf" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/intro.html" class="sidebar-link">Welcome to MechWolf</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>About</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/about/faq.html" class="sidebar-link">FAQ</a></li><li><a href="/about/support.html" class="sidebar-link">Get Support</a></li><li><a href="/about/why.html" class="sidebar-link">Why Use MechWolf</a></li><li><a href="/about/license.html" class="sidebar-link">License</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/gentle_intro.html" class="sidebar-link">A Very Gentle Introduction</a></li><li><a href="/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/guide/getting_started.html" class="sidebar-link">Getting Started</a></li><li><a href="/guide/new_components.html" class="active sidebar-link">Creating New Components</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/new_components.html#general-approach" class="sidebar-link">General Approach</a></li><li class="sidebar-sub-header"><a href="/guide/new_components.html#example-making-the-philosopher-s-stone" class="sidebar-link">Example: Making the Philosopher's Stone</a></li><li class="sidebar-sub-header"><a href="/guide/new_components.html#example-the-vici-valve" class="sidebar-link">Example: The Vici Valve</a></li><li class="sidebar-sub-header"><a href="/guide/new_components.html#a-note-on-naming" class="sidebar-link">A Note on Naming</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="creating-new-components"><a href="#creating-new-components" aria-hidden="true" class="header-anchor">#</a> Creating New Components</h1> <h2 id="general-approach"><a href="#general-approach" aria-hidden="true" class="header-anchor">#</a> General Approach</h2> <p>You may find yourself in the position that MechWolf's included
components aren't what you need. In that case, you'll have to create
your own component. Here's how:</p> <ol><li><p><strong>Decide what kind of component it is.</strong><br>
If you're trying to make a new kind of pump, for example, you'll
want to be inheriting from <code>~mechwolf.components.pump.Pump</code>. For
components being controlled (i.e. not aliases of
<code>~mechwolf.components.component.Component</code>), you'll have to
create a subclass of
<code>~mechwolf.components.component.ActiveComponent</code>. If you are
only creating an alias of <code>~mechwolf.validate_component</code>, you
can skip 4–6.</p></li> <li><p><strong>Create a new class.</strong><br>
If you're struggling, see <a href="https://docs.python.org/3/tutorial/classes.html" target="_blank" rel="noopener noreferrer">the official Python
docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, a handy
<a href="https://www.tutorialspoint.com/python3/python_classes_objects.htm" target="_blank" rel="noopener noreferrer">tutorial on
classes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
or look at MechWolf's source code. Make sure to add <code>name</code> as an
argument to <code>__init__</code> and the line
<code>super().__init__(name=name)</code>, which tells Python to pass the
name argument up to the
<code>~mechwolf.components.component.ActiveComponent</code> class.</p></li> <li><p><strong>Give the component its attributes.</strong><br>
This means that anything that you will be using as keywords
during your calls to <code>~mechwolf.Protocol.add</code> must be
attributes. Furthermore, if they are quantities such as &quot;10
mL/min&quot;, these attributes should be parsed Quantity objects.</p></li> <li><p><strong>Give it a base state method.</strong><br>
MechWolf requires that any component being modified as part of a
protocol have a base state which it will return to after the
protocol. For things that turn on, this base state is usually
&quot;off&quot;. The base state method must be called <code>base_state</code> and
return a dict with attribute as keys and settings for those
attributes as values. For a Varian pump, it could look like
this:</p> <pre><code>&gt;&gt;&gt; VarianPump(name=&quot;pump&quot;).base_state()
{&quot;rate&quot;: &quot;0 mL/min&quot;}
</code></pre> <p>The values in the base state dictionary need to be parsable into
valid values, the same as if they were passed as keyword
arguments to <code>~mechwolf.Protocol.add</code>. In fact, under the hood,
that is exactly what is happening. At the end of your protocol,
<code>~mechwolf.Protocol.compile</code> adds a procedure for each
<code>~mechwolf.components.component.ActiveComponent</code> in the protocol
to return to its base state.å</p></li> <li><p><strong>Give it an update method.</strong><br>
The job of the update method is to make the object's real-world
state match its virtual representation. This is where the
hardware interfacing happens.</p> <p>Note, however, that because MechWolf objects have two distinct
uses (being manipulated before runtime and actually used during
runtime to control the hardware), components must be able to be
instantiated without respect to it's real-world configuration.
For example, this means that, to enforce a level of abstraction,
you shouldn't need to know what serial port your client is
talking to your component in order to manipulate it when
creating your script. The object that is being run on your
client <em>would</em> need to know that though, so the object has to be
able to support both uses.</p> <p>Note: this step doesn't apply to
<code>~mechwolf.components.sensor.Sensor</code> s, which already have a
built-in update method.</p></li> <li><p><strong>For sensors, give it a read method.</strong></p> <blockquote><p>This is where the actual data collection goes. It should return
the data read in from the sensor. MechWolf will automatically
timestamp it, so don't worry about that.</p></blockquote></li> <li><p><strong>Test thoroughly with</strong> <code>~mechwolf.validate_component</code>.<br>
For your convenience, the <code>~mechwolf.validate_component</code>
function will take an instance of your class (not the class
itself) and verify that it meets the requirements to be used in
a protocol.</p></li> <li><p><strong>Contribute to GitHub</strong> <em>(optional)</em><br>
Odds are you're not the only person in the world who could use
the component you're making. In the spirit of collaboration, we
welcome any and all components submitted to us that are
compatible with our API and encourage you to submit your
component in a pull request.</p></li></ol> <h2 id="example-making-the-philosopher-s-stone"><a href="#example-making-the-philosopher-s-stone" aria-hidden="true" class="header-anchor">#</a> Example: Making the Philosopher's Stone</h2> <p>Let's say that you discovered the <a href="https://en.wikipedia.org/wiki/Philosopher%27s_stone" target="_blank" rel="noopener noreferrer">philosopher's
stone<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, which is
capable of turning anything into gold. But that's not good enough. You
want an automated philosopher's stone with MechWolf!</p> <p>To make it work with MechWolf, we'll follow the process of creating a
new component by making a blank class that inherits from
<code>~mechwolf.components.component.ActiveComponent</code>:</p> <pre><code>from mechwolf import ActiveComponent

class PhilosophersStone(ActiveComponent):
    def __init__(self, name=None):
        super().__init__(name=name)
</code></pre> <p>For attributes, let's imagine that the philosopher's stone can convert a
variable mass of the solution flowing through it into gold:</p> <pre><code>from mechwolf import ActiveComponent, ureg

class PhilosophersStone(ActiveComponent):
    def __init__(self, name=None):
        super().__init__(name=name)
        self.rate = ureg.parse_expression(&quot;0 g/min&quot;)
</code></pre> <p>Now we'll need a base state:</p> <pre><code>from mechwolf import ActiveComponent, ureg

class PhilosophersStone(ActiveComponent):
    def __init__(self, name=None):
        super().__init__(name=name)
        self.rate = ureg.parse_expression(&quot;0 g/min&quot;)

    def base_state(self):
        return dict(rate=&quot;0 g/min&quot;)
</code></pre> <p>And finally, a way to update it. Here, we'll have to rely on our
imagination:</p> <pre><code>from mechwolf import ActiveComponent, ureg

class PhilosophersStone(ActiveComponent):
    def __init__(self, name=None, serial_port=None):
        super().__init__(name=name)
        self.rate = ureg.parse_expression(&quot;0 g/min&quot;)
        self.serial_port = serial_port

    def base_state(self):
        return dict(rate=&quot;0 g/min&quot;)

    async def update(self):
        # magic goes here
        yield
</code></pre> <p>Saving it as <code>philosophersstone.py</code>, we can then use
<code>~mechwolf.validate_component</code> to test if instances of the class are
valid:</p> <pre><code>&gt;&gt;&gt; import mechwolf as mw
&gt;&gt;&gt; from philosophersstone import PhilosophersStone
&gt;&gt;&gt; stone = PhilosophersStone(name=&quot;stone&quot;)
&gt;&gt;&gt; mw.validate_component(stone)
True
</code></pre> <p><code>~mechwolf.validate_component</code> returned <code>True</code>, meaning that the
philosopher's stone class is facially valid.</p> <h2 id="example-the-vici-valve"><a href="#example-the-vici-valve" aria-hidden="true" class="header-anchor">#</a> Example: The Vici Valve</h2> <p>The last example, though illustrative, isn't actually a working
component, since (unfortunately) philosophers' stones don't exist.
Luckily, we have the next best thing: a Vici valve. To show how to
create working components, we'll walk through MechWolf's implementation
of <code>~mechwolf.components.vici.ViciValve</code>.</p> <p>First, we need to include the import statements at the top. We
communicate with Vici valves via serial on the client, but don't
actually <em>need</em> the serial package in order to instantiate a
<code>~mechwolf.components.vici.ViciValve</code> object. That's because you need to
be able to instantiate <code>~mechwolf.components.vici.ViciValve</code> objects on
devices without the client extras installed (which includes the serial
package), such as when designing apparatuses on your personal computer.
For that reason, we wrap <code>import serial</code> in a try-except clause:</p> <div data-lines="3-6" class="literalinclude"><p>../../../mechwolf/components/vici.py</p></div> <p>Because Vici valves are subclasses of
<code>~mechwolf.components.valve.Valve</code>, we also need to import
<code>~mechwolf.components.valve.Valve</code>. Since <code>vici.py</code> is in the components
directory, we do a local import:</p> <div data-lines="8" class="literalinclude"><p>../../../mechwolf/components/vici.py</p></div> <p>If we were creating the object in a different directory, we would import
<code>~mechwolf.components.valve.Valve</code> the usual way:</p> <pre><code>from mechwolf import Valve
</code></pre> <p>Now that we've got the modules we'll need, let's create the class:</p> <div data-lines="10-11" class="literalinclude"><p>../../../mechwolf/components/vici.py</p></div> <p>And we'll create an <code>__init__()</code> method:</p> <div data-pyobject="ViciValve.__init__" class="literalinclude"><p>../../../mechwolf/components/vici.py</p></div> <p>Note that the arguments include the ones required by
<code>~mechwolf.components.valve.Valve</code> (<code>name</code> and <code>mapping</code>) and
<code>serial_port</code>, which is needed to connect to the physical component on
the client.</p> <p>We can skip adding a base state because
<code>~mechwolf.components.valve.Valve</code> already has one, meaning that
<code>~mechwolf.components.vici.ViciValve</code> will inherit it automatically.</p> <p>Now for the important parts: we need to make the object be able to make
its real-world state match the object's state. We do that with the
<code>update</code> method. It needs to be an <code>async</code> function that yields data to
be reported back to the hub. This is the driver, the heart of the
component that allows for execution:</p> <div data-pyobject="ViciValve.update" class="literalinclude"><p>../../../mechwolf/components/vici.py</p></div> <p>The exact implementation will vary from component to component, but the
basic idea is that it sends the message in a format that the component
can understand.</p> <p>One thing to know about serial connections is that they need to be
opened and closed. However, you don't want to open and close the
connection after every procedure, especially if you'll be doing a lot of
procedures in a short duration. Instead, you want to open the connection
once at the beginning and close it at the end when you're done with the
component. MechWolf can handle that automatically if you give it some
additional information, namely functions called <code>__enter__</code> and
<code>__exit__</code>.</p> <p>In Vici valves, <code>__enter__</code> creates a serial connection once when you
start the client and then returns <code>self</code>:</p> <div data-pyobject="ViciValve.__enter__" class="literalinclude"><p>../../../mechwolf/components/vici.py</p></div> <p>Similarly, <code>__exit__</code> closes the connection:</p> <div data-pyobject="ViciValve.__exit__" class="literalinclude"><p>../../../mechwolf/components/vici.py</p></div> <p><code>343</code> and this <a href="https://stackoverflow.com/questions/1984325/explaining-pythons-enter-and-exit" target="_blank" rel="noopener noreferrer">StackOverflow
answer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
have more about information about how to use <code>__enter__</code> and <code>__exit__</code>
methods.</p> <p>That's it! We now have a functioning Vici valve. Let's test it with
<code>~mechwolf.validate_component</code>:</p> <pre><code>&gt;&gt;&gt; import mechwolf as mw
&gt;&gt;&gt; mw.validate_component(mw.ViciValve(name=&quot;test&quot;, mapping={}))
True
</code></pre> <p>Sure enough, it works. This isn't just an example however, it's exactly
how the Vici valve in the <code>~mechwolf.components.vici</code> module works!</p> <p>If you're stuck trying to make a new component, don't hesitate to reach
out for <code>help &lt;support&gt;</code>.</p> <h2 id="a-note-on-naming"><a href="#a-note-on-naming" aria-hidden="true" class="header-anchor">#</a> A Note on Naming</h2> <p>Be sure to follow MechWolf's naming convention, especially if you plan
on contributing to the GitHub. Classes are named in CamelCase format in
keeping with <a href="https://www.python.org/dev/peps/pep-0008/#class-names" target="_blank" rel="noopener noreferrer">PEP 08's class name
specification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Benjamin-Lee/mechwolf/edit/master/guide/new_components.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/8/2019, 7:53:12 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/guide/getting_started.html" class="prev">
          Getting Started
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.99d75b88.js" defer></script><script src="/assets/js/2.8d8c6c90.js" defer></script><script src="/assets/js/13.c537ffe1.js" defer></script>
  </body>
</html>
